# README file for run

VMM3a/SRS Data Analysis Tool: 
vmm-sdat is the analysis software for VMM3a data, recorded with the SRS or the ESS readout as PCAP files. From the PCAP file, a root tree with the hits and clusters is created. To create the pcapng file, the user has to directly get the UDP frames from the network card of the DAQ computer. This can be done with tcdump or Wireshark. The captured data has to be saved as pcapng file.

## Running the convertFile utility
The convertFile utility reads in the pcap file, and produces a root tree with the hits and clusters. The utility can be run directly from the command line, but since there are many parameters to be set, it is easier to use a script. In the analysis folder one finds the runConversion.py script. The script illustrates, how to run convertFile with the example.pcapng data file. The script shows how to store hits, plane clusters and detector clusters. The meaning of the command line parameters is explained in the main README file. 

## Geometry files
Instead of defining the geometry with the parameters -vmm, -axis, -map one can also use a JSON geometry file. The file example_geometry.json in the run directory illustrates the format. In the script runConversion_geometry.py shows how to use the geometry file. In case the detector readout is pads and not strips, the file example_geometry_pads.json illustrates how to define such a detector. The script runConversion_geometry_pad.py executes the pad example. The example geometry_LET.json shows a geometry implementation of a MultiGrid detector that consists of wires and grids. For the grids only some channels on one VMM on the hybrid are used, whereas for the wires two VMMs on one hybrid are used. The channels that are not connected on the VMM3a are marked with a -1. The data format of the example_LET.pcapng file is the ESS data format, whereas the other pcapng files are in the SRS data files. The NIP example  runConversion_NIP.py shows how to define the VMM connected to the trigger box as plane 2 of a detector. The vmm channel representing bit 0 of the event-Id has to be mapped to strip 0, the channel presenting bit 1 to strip 1 and so on. As algorithm algo5 has to be chosen. Algo5 then decodes the event-ID from the strip pattern and writes it as integer into the time2_algo field in the tree.

If you define in your geometry file "plane2", vmm-sdat assumes that you are using a flat geometry with three planes of strips, like XYU or XUV. The tool then tries to find clusters in all three planes, and does not only match plane 0 and plane 1 as in the normal strip readout. Since the angles between the planes are not known in the XYU or XUV case, vmm-sdat does not provide overview plots for plane 2. The example runConversion_xyu.py illustrates the use of an xyu geometry with planes 0,1 and 2.

## Calibration files
The VMM3a slow control tool https://gitlab.cern.ch/mguth/VMM-software-RD51 can generate calibration files that modify the ADC values and/or the time measurements of each channel. If a reliable calibration has been found, the JSON calibration file can be loaded into vmm-sdat to correct the ADC values. In the python script runConversion_calib.py exactly this is done, the example_calib.json file is applied to the data.

